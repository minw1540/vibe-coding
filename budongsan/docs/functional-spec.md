🏡 나만의 스마트 부동산 시트 웹/앱 서비스 기능 명세서 🏡
본 문서는 '나만의 스마트 부동산 시트' 웹/앱 서비스의 핵심 기능들을 상세히 정의하고, 각 기능의 로직, 사용자 흐름, UI 요소 및 필요한 데이터를 명세합니다. 이는 서비스 개발을 위한 구체적인 가이드라인으로 활용될 것입니다.

1. 개요
이 기능 명세서는 이전에 승인된 '나만의 스마트 부동산 시트' 서비스 기획서를 기반으로 합니다. 사용자가 자신의 부동산 관심 매물 데이터를 직접 생성, 관리, 분석할 수 있도록 돕는 웹 및 모바일 앱 서비스 구현을 목표로 합니다. 모든 정보는 테이블(표) 형태로 제공되며, 소셜 로그인 기반의 사용자 계정 시스템을 통해 개인화된 경험을 제공합니다.

2. 공통 로직 및 전역 요소
데이터 소스: 모든 부동산 실거래가 데이터는 국토교통부 부동산 실거래가 공개시스템 API를 주된 데이터 소스로 활용합니다.

추가: 전세가 데이터를 위한 국토교통부 '아파트 전월세 실거래가 상세 자료' API를 별도로 연동하여 활용합니다.

추가: "필요시 공공데이터 포털의 추가적인 부동산 관련 통계 데이터"는 인구 통계, 학군 정보, 상권 데이터 등을 포함하며, 이 데이터들은 MySQL에 별도의 테이블로 구축되어 관리됩니다.

데이터 처리: API를 통해 수집된 데이터는 정제 및 가공 과정을 거쳐 서비스 내에서 활용됩니다.

추가: 정제 및 가공 과정: dealAmount 필드의 콤마 제거, excluUseAr의 기본 단위는 제곱미터(㎡)로 통일하며, 사용자 설정에 따라 평으로 변환하여 표시합니다. 날짜 형식 통일(YYYYMMDD -> YYYY-MM-DD) 등을 포함합니다.

에러 처리: API 호출 실패, 데이터 로드 실패 등 발생 가능한 모든 에러 상황에 대해 사용자에게 명확한 메시지를 제공하고, 재시도 옵션을 제시합니다.

추가: API별, 기능별로 발생 가능한 주요 에러 코드(기술 문서 참고)에 따라 구체적인 사용자 메시지를 제공합니다. (예: No Data 에러 시 "해당 기간/지역의 매물 정보가 없습니다." 메시지 표시)

로딩 상태: 데이터 로딩 중에는 사용자에게 로딩 스피너 또는 메시지를 표시하여 대기 상태임을 알립니다.

반응형 UI/UX: 웹과 앱 모두 다양한 디바이스(데스크톱, 태블릿, 모바일) 및 화면 크기에 최적화된 반응형 UI/UX를 제공합니다. 모든 테이블은 스크롤이 가능하며, 작은 화면에서도 정보가 잘리지 않고 가독성을 유지하도록 설계합니다.

추가: 모바일 환경에서 테이블의 컬럼 수가 많을 경우, 가로 스크롤 외에 '컬럼 선택/숨기기' 기능과 '카드 뷰' 전환 기능을 모두 제공하여 사용성을 높입니다.

데이터베이스 아키텍처:

MySQL (관계형 데이터베이스): 사용자 계정 정보, 미리 구축된 지역별 특징 및 단지 개요, 그리고 국토부 API를 통해 수집 및 가공된 기본 부동산 매물 정보 등 정형화되고 관계가 중요한 데이터를 저장합니다.

MongoDB (NoSQL 데이터베이스): 사용자의 '나만의 관심 매물 시트' 데이터 (사용자 정의 컬럼 및 태그 포함), 알림 설정 및 알림 모니터링을 위한 매물 스냅샷 등 유연한 스키마와 실시간 동기화/변경 감지가 필요한 개인화된 데이터를 저장합니다.

공통 단위 설정 및 변환:

목적: 사용자가 면적 단위를 '제곱미터(㎡)'와 '평' 중에서 선택하여 서비스 전반에 걸쳐 일관된 단위로 정보를 열람할 수 있도록 합니다.

주요 UI 요소 및 상호작용:

단위 선택 UI: 모든 주요 화면(검색 결과, 단지 상세, 시트, 상세 분석, 알림 설정 등)의 상단 헤더 영역에 '㎡ / 평' 전환 토글 버튼을 제공하여 아주 손쉽게 접근하고 변경할 수 있도록 합니다.

상호작용:

사용자가 단위 선택 UI를 조작하면, 모든 화면에 표시되는 면적 관련 수치들이 선택된 단위로 즉시 변환되어 표시됩니다.

선택된 단위 설정은 사용자 계정 정보에 저장되어, 재접속 시에도 유지됩니다.

상세 로직:

단위 변환 공식: 1평 = 3.30578 ㎡ (또는 1㎡ = 0.3025 평)

클라이언트 측 변환: 백엔드에서 기본적으로 ㎡ 단위로 데이터를 제공하고, 클라이언트(웹/앱)에서 사용자의 설정에 따라 실시간으로 평으로 변환하여 표시합니다.

설정 저장: 사용자가 선택한 단위 설정(unitPreference: 'sqm' 또는 'pyeong')은 MySQL의 사용자 설정 테이블에 저장됩니다.

데이터 요구사항:

사용자 설정 (MySQL): unitPreference (string, 'sqm' 또는 'pyeong').

3. 주요 기능 상세 명세
3.1. 사용자 계정 관리
목적: 사용자의 서비스 접근을 제어하고, 개인화된 매물 시트 및 설정 정보를 안전하게 저장하고 관리할 수 있도록 합니다.

사용자 흐름:

사용자가 서비스에 접속합니다.

로그인/회원가입 페이지로 이동합니다.

제공되는 소셜 로그인 옵션(카카오, 네이버, 구글) 중 하나를 선택합니다.

선택한 소셜 서비스의 인증 절차를 따릅니다.

인증 성공 시, 서비스에 자동으로 로그인되고 메인 페이지로 리디렉션됩니다. (최초 로그인 시 회원가입 처리)

로그인 후, 마이페이지에서 개인 정보(연동된 소셜 계정 정보)를 확인하고, 필요한 경우 회원 탈퇴를 진행합니다.

상세 로직:

회원가입/로그인:

클라이언트(웹/앱)에서 사용자가 선택한 소셜 로그인 버튼 클릭 시, 해당 소셜 서비스의 OAuth 2.0 인증 흐름을 시작합니다.

소셜 서비스로부터 사용자 정보(고유 ID, 이메일 등)를 받아 백엔드로 전송합니다.

백엔드는 수신된 소셜 ID를 기반으로 기존 사용자 여부를 확인합니다.

새로운 사용자일 경우, 해당 소셜 ID와 연동하여 신규 회원으로 등록하고, 사용자 고유 ID를 생성하여 MySQL에 저장합니다. 이때, 소셜 프로필에서 가져온 사용자 닉네임을 초기 설정값으로 저장하고 마이페이지 등에 활용할 수 있도록 합니다.

기존 사용자일 경우, 해당 사용자 ID로 로그인 세션을 생성합니다.

로그인 성공 시, 사용자 고유 ID를 포함하는 인증 토큰을 클라이언트에 발급하고, 클라이언트는 이를 저장하여 로그인 상태를 유지합니다. 인증 토큰은 유효 기간(예: 1시간)을 가지며, Refresh Token을 사용하여 자동 갱신 전략을 구현합니다.

개인정보 관리:

마이페이지 접근 시, 현재 로그인된 사용자의 정보를 MySQL로부터 조회하여 표시합니다.

회원 탈퇴 요청 시, 사용자에게 최종 확인 절차를 거친 후, 해당 사용자의 MySQL에 저장된 계정 정보 및 MongoDB에 저장된 모든 서비스 데이터(매물 시트, 알림 설정 등)를 삭제하고 계정을 비활성화 또는 삭제 처리합니다.

UI 요소 및 상호작용:

로그인/회원가입 페이지:

"카카오로 시작하기", "네이버로 시작하기", "구글로 시작하기" 등의 버튼 제공.

서비스 소개 문구 및 회원가입 유도 메시지.

마이페이지:

연동된 소셜 계정 정보 표시.

"회원 탈퇴" 버튼.

데이터 요구사항:

사용자 정보 (MySQL): 소셜 서비스 고유 ID, 서비스 내 사용자 고유 ID, 가입일, 최종 로그인일, 소셜 서비스 제공자 (예: 'kakao', 'naver', 'google'), 사용자 닉네임.

사용자 데이터 (MongoDB): '나만의 관심 매물 시트' 데이터, 알림 설정 등은 사용자 고유 ID에 매핑되어 저장.

3.2. 매물 검색 및 단지 탐색
목적: 사용자가 원하는 지역 또는 주소의 부동산 단지 정보를 효율적으로 검색하고 개요를 파악할 수 있도록 합니다.

사용자 흐름:

사용자는 검색 페이지에 접속합니다.

지역 기반 탐색: 드롭다운 메뉴에서 '광역시/도' 선택 -> '시/군/구' 선택.

주소 입력 탐색: 검색창에 '아파트 단지명' 또는 '도로명 주소' 입력 후 검색 버튼 클릭. (자동 완성 기능 제공)

검색 결과로 해당 지역/주소의 단지 목록이 테이블 형태로 표시됩니다.

사용자는 가격대, 면적대, 세대수, 준공년도 등 필터 조건을 설정하여 검색 결과를 좁힙니다.

필터링된 단지 목록을 확인하고, 특정 단지 행에 마우스를 올리거나 클릭/탭하여 단지 미리보기 정보를 확인합니다.

상세 로직:

검색 요청:

지역 선택 또는 주소 입력 시, 백엔드 API로 검색 요청을 보냅니다.

백엔드는 국토교통부 아파트 매매 실거래가 상세 자료 API (getRTMSDataSvcAptTradeDev)를 호출하여 해당 조건에 맞는 단지 정보를 조회합니다.

요청 파라미터:

serviceKey (필수): 공공데이터포털에서 발급받은 인증키

LAWD_CD (필수): 행정표준코드관리시스템(www.code.go.kr)의 법정동 코드 중 앞 5자리 (예: 서울 종로구 - 11110)

DEAL_YMD (필수): 실거래 자료의 계약년월(6자리) (예: 202407)

pageNo (옵션): 페이지 번호 (기본값: 1)

numOfRows (옵션): 한 페이지 결과 수 (기본값: 10)

API 호출 예시:
GET http://apis.data.go.kr/1613000/RTMSDataSvcAptTradeDev/getRTMSDataSvcAptTradeDev?serviceKey={YOUR_SERVICE_KEY}&LAWD_CD=11110&DEAL_YMD=202407&pageNo=1&numOfRows=10

성능 고려 및 캐싱 전략: DEAL_YMD 파라미터가 단일 월만 조회 가능하므로, 특정 지역의 '최근 1년치' 데이터를 조회하려면 백엔드에서 해당 지역의 LAWD_CD와 함께 12번의 API 호출을 수행해야 합니다. 이를 위해 주기적으로 국토부 API 데이터를 수집하여 MySQL에 미리 저장(캐싱)하는 배치 시스템을 구축하고, 필요시 인메모리 캐시를 활용하여 API 호출 횟수 및 응답 시간을 최적화합니다.

"주소 입력 탐색" 시, 입력된 주소를 LAWD_CD로 변환하는 로직은 공공데이터포털의 주소-법정동 코드 변환 API를 활용하여 변환합니다.

API 응답으로 받은 단지별 실거래가 데이터(최근 1년치 등)를 가공하여 대표 면적, 최저/최고 실거래가 범위를 계산하고, MySQL에 저장된 단지 개요 정보와 결합하여 반환합니다.

"대표 면적" 계산 로직: 최근 1년간 해당 단지의 거래량 기준, 가장 많은 거래가 발생한 전용면적을 대표 면적으로 정의합니다. (거래량 동률 시, 평균 거래 금액이 높은 면적 우선)

응답 데이터 주요 항목: aptNm(단지명), excluUseAr(전용면적), dealAmount(거래금액), dealYear(계약년도), dealMonth(계약월), dealDay(계약일), floor(층), buildYear(건축년도), sggCd(법정동시군구코드), umdNm(법정동), jibun(지번), roadNm(도로명) 등.

필터링:

클라이언트에서 사용자가 필터 조건을 변경할 때마다, 현재 표시된 단지 목록에 대해 클라이언트 측 필터링을 적용하거나 (데이터 양이 적을 경우), 서버 측에 새로운 필터링 조건을 포함한 검색 요청을 보냅니다 (데이터 양이 많을 경우).

필터링 조건 예시:

가격대: minPrice=500000000&maxPrice=1000000000 (dealAmount 필드 활용)

면적대: minArea=80&maxArea=100 (제곱미터 기준, excluUseAr 필드 활용)

준공년도: minYear=2000&maxYear=2010 (buildYear 필드 활용)

단지 개요/미리보기:

지역 선택 또는 주소 검색 시, MySQL에 미리 구축된 지역별 특징 데이터베이스에서 해당 지역의 정보를 조회하여 표시합니다.

단지 미리보기는 해당 단지의 고유 ID를 기반으로 MySQL에 미리 구축된 단지 개요 데이터를 조회하여 팝업/패널 형태로 표시합니다.

UI 요소 및 상호작용:

검색 영역: 광역시/도, 시/군/구 드롭다운, 주소 입력 검색창, 검색 버튼.

필터 영역: 가격 슬라이더, 면적 범위 입력 필드, 세대수/준공년도 드롭다운/입력 필드, 난방방식 체크박스 등.

검색 결과 테이블:

컬럼: 단지명, 대표 면적, 최저 실거래가, 최고 실거래가, 총 세대수, 준공년도, 건설사.

데이터: 국토부 API 연동 데이터를 가공하여 표시.

상호작용:

각 행 클릭/탭 시 단지 상세 페이지로 이동.

각 행 호버(웹) 시 또는 클릭/탭(앱) 시 단지 미리보기 팝업/패널 표시.

데이터 로딩/빈 상태:

데이터 로딩 중: 로딩 스피너 또는 "데이터를 불러오는 중입니다..." 메시지 표시.

검색 결과 없음: "검색 결과가 없습니다. 다른 조건으로 검색해보세요." 메시지 표시.

페이지네이션: 대량의 검색 결과를 효율적으로 탐색할 수 있도록 페이지네이션 컨트롤을 구현하며, **"총 X건 중 1-10번 표시"**와 같이 현재 페이지 정보와 전체 결과 수를 명확히 인지할 수 있도록 UI 요소를 추가합니다.

단지 미리보기 팝업/패널:

내용: 단지명, 준공연도, 총 세대수, 세대당 주차 대수, 난방방식 등 핵심 특징 요약.

상호작용: 팝업 외부 클릭/탭 또는 닫기 버튼 클릭 시 닫힘. "자세히 보기" 버튼을 추가하여 클릭/탭 시 해당 단지 상세 정보 페이지(DETAIL_001)로 바로 이동하도록 합니다.

지역 개요 패널: 검색 결과 상단에 해당 지역의 특징 요약 텍스트.

데이터 요구사항:

국토부 실거래가 API 응답 데이터: 단지명 (aptNm), 주소 (sggCd, umdNm, jibun, roadNm 등 조합), 전용면적 (excluUseAr), 거래금액 (dealAmount), 계약년월일 (dealYear, dealMonth, dealDay), 층 (floor), 건축년도 (buildYear), 단지 일련번호 (aptSeq) 등.

미리 구축된 데이터베이스 (MySQL): 지역별 특징(상권, 교통, 학군 등), 단지별 개요(세대수, 사용승인일, 주차, 용적률/건폐율, 건설사, 난방방식 등).

3.3. 단지 상세 정보 확인 및 '개인화된 매물 비교 테이블'에 추가
목적: 사용자가 특정 단지의 상세 정보를 확인하고, 관심 있는 면적을 자신의 개인화된 비교 시트에 추가할 수 있도록 합니다.

사용자 흐름:

매물 검색 결과에서 특정 단지 행을 클릭/탭하여 상세 정보 페이지로 이동합니다.

'단지 정보' 섹션에서 단지 개요를 확인합니다.

'단지 내 면적별 정보' 섹션에서 해당 단지의 면적별 실거래가 및 전세가 정보를 테이블로 확인합니다.

관심 있는 면적의 행 옆에 있는 '시트에 추가' 버튼을 클릭/탭합니다.

해당 면적 정보가 사용자의 '나만의 관심 매물 시트'에 자동으로 추가됩니다.

상세 로직:

페이지 로드: 이전 페이지에서 전달받은 단지 고유 ID를 기반으로 백엔드 API를 호출하여 해당 단지의 모든 상세 정보를 조회합니다. (예: GET /api/complexes/{complexId}/details)

이때, 국토부 API의 LAWD_CD와 DEAL_YMD를 조합하여 해당 단지의 모든 면적별, 월별 실거래가 이력을 조회합니다. aptSeq (단지 일련번호)를 활용하여 특정 단지의 데이터를 필터링합니다.

전세가 데이터는 국토부 '아파트 전월세 실거래가 상세 자료' API를 별도로 호출하여 연동합니다.

단지 상세 정보 페이지에서 '총 세대수', '주차 대수', '용적률/건폐율' 등은 국토부 실거래가 API에서 직접 제공되지 않는 정보이므로, 이 데이터들은 MySQL에 미리 구축된 데이터베이스에서 조회하여 활용합니다. 해당 데이터의 수집 및 갱신 방안(예: 공공데이터포털, 건축물대장 정보 활용, 주기적 업데이트)을 명확히 합니다.

면적별 정보: 조회된 단지 정보 중 면적별 실거래가 및 전세가 데이터를 가공하여 테이블 형태로 표시합니다. (예: 각 면적별 최근 1년간 월별 실거래가 평균, 최고/최저가, 전세가율 등)

시트 추가:

'시트에 추가' 버튼 클릭 시, 클라이언트에서 해당 면적의 핵심 정보(단지명, 면적, 주소, 최근 실거래가, 전세가, 준공연도, 세대수 등)를 추출합니다.

로그인된 사용자 ID와 함께 해당 정보를 백엔드로 전송하여, 사용자의 개인화된 매물 시트 데이터베이스(MongoDB)에 추가합니다. (예: POST /api/users/{userId}/my-sheet, body: { propertyData })

성공적으로 추가되면 사용자에게 알림 메시지("시트에 추가되었습니다!")를 표시합니다. 이미 시트에 추가된 매물인 경우, 버튼 텍스트를 "시트에 추가됨"으로 변경하고 비활성화하여 중복 추가를 방지하며, 해당 매물이 시트의 어느 위치에 추가되었는지 (예: "나만의 시트 1번 항목에 추가되었습니다.") 안내해 주면 사용자 편의성이 더욱 높아집니다.

UI 요소 및 상호작용:

단지 상세 정보 페이지:

'단지 정보' 섹션: 단지명, 주소, 세대수, 사용승인일, 용적률, 건폐율, 건설사, 난방방식, 관리사무소 정보 등을 표 또는 텍스트 블록으로 표시.

'단지 내 면적별 정보' 섹션:

컬럼: 면적(공급/전용), 최근 실거래가, 최근 전세가, 전세가율, 최근 거래일 등.

각 행 옆에 '시트에 추가' 버튼 또는 체크박스.

데이터 요구사항:

미리 구축된 단지 상세 데이터 (MySQL): 세대수, 사용승인일, 용적률, 건폐율, 건설사, 난방방식, 관리사무소 정보 등.

국토부 실거래가 API 응답 데이터: 면적별 실거래가 및 전세가 이력.

사용자 개인 시트 저장 데이터 (MongoDB): 단지명, 면적, 주소, 최근 실거래가, 전세가, 준공연도, 세대수, 사용자 고유 ID.

3.4. '개인화된 매물 비교 테이블' 관리 및 분석
목적: 사용자가 자신만의 관심 매물 목록을 엑셀과 유사한 형태로 관리하고, 강력한 필터링/정렬 및 비교 분석 기능을 통해 효율적인 의사결정을 돕습니다.

사용자 흐름:

로그인 후 '나만의 시트' 페이지로 이동합니다.

추가했던 매물 목록이 테이블 형태로 표시됩니다.

각 매물 행의 '나만의 메모' 필드를 직접 편집합니다.

사용자 정의 컬럼 추가: '컬럼 추가' 버튼을 클릭하여 새로운 컬럼 이름을 입력하고 시트에 추가합니다.

태그 추가: 각 매물 행에 태그를 입력하거나 기존 태그를 선택하여 부여합니다.

필터링/정렬 기능을 사용하여 원하는 조건의 매물만 확인하거나 순서를 변경합니다.

비교하고 싶은 2개 이상의 매물을 선택하고 '비교하기' 버튼을 클릭합니다.

비교 분석 리포트가 팝업 또는 별도 섹션으로 표시됩니다.

상세 로직:

시트 로드 및 저장:

'나만의 시트' 페이지 로드 시, 로그인된 사용자 ID를 기반으로 MongoDB에 저장된 매물 시트 데이터를 조회합니다. (실시간 동기화는 MongoDB Change Streams를 활용하여 구현 방안을 개발팀과 논의하여 확정합니다.)

'나만의 메모' 및 사용자 정의 컬럼 값 변경 시, 해당 데이터는 입력 완료 시 자동 저장되는 방식으로 데이터 유실을 방지합니다. 명시적인 '저장' 버튼도 제공할 수 있습니다.

사용자 정의 컬럼/태그:

컬럼 추가: 사용자가 입력한 컬럼 이름을 사용자 설정 정보에 저장하고, 시트 데이터 구조에 해당 컬럼을 추가하여 표시합니다. 각 매물 데이터 객체에 해당 컬럼의 값을 저장할 수 있도록 합니다. 사용자 정의 컬럼 생성 시 텍스트, 숫자, 날짜 등 데이터 타입을 지정할 수 있도록 구현하며, 이에 따라 필터링/정렬 방식이 달라지도록 구현합니다.

태그: 각 매물 데이터 객체 내에 태그 리스트(배열)를 저장합니다. 태그 입력 시 기존 태그 목록을 보여주거나, 새로운 태그를 추가할 수 있도록 합니다. 태그 개수는 최대 5개, 태그 길이는 최대 10자로 제한하여 데이터 관리 및 UI 표시의 복잡도를 낮춥니다.

필터링/정렬:

클라이언트 측에서 현재 표시된 매물 데이터 배열에 대해 JavaScript의 filter() 및 sort() 메서드를 활용하여 실시간으로 적용합니다.

필터 조건 예시: data.filter(item => item.price >= minPrice && item.tags.includes('급매'))

비교 분석 리포트 제공:

데이터 추출: 선택된 매물들의 모든 상세 데이터를 MongoDB에서 추출하고, 필요한 경우 MySQL에 저장된 추가 정보(예: 단지별 입지 데이터)를 결합합니다.

비교 항목 정의:

가격 변동성: 각 매물의 과거 실거래가 데이터를 조회하여 최근 1년/3년/5년 등의 가격 변동률을 계산합니다. (예: (최신실거래가 - 1년전실거래가) / 1년전실거래가 * 100)

활용 API 필드: dealAmount, dealYear, dealMonth, dealDay

면적 효율성: 평당 가격 = 최근 실거래가 / (공급면적 / 3.30578)을 계산하여 비교합니다.

활용 API 필드: dealAmount, excluUseAr

연식 및 세대수: 준공연도 차이, 총 세대수 차이를 비교합니다.

활용 API 필드: buildYear (총 세대수는 MySQL에 미리 구축된 데이터베이스에서 활용)

입지 조건: MySQL에 미리 구축된 데이터에서 지하철역과의 거리(도보 시간), 학군 선호도(등급 또는 배정 학교명), 주요 상권과의 거리 등을 조회하여 비교합니다. 이 데이터는 외부 데이터 구매, 공공데이터 크롤링, 또는 초기 수동 입력 후 주기적인 갱신을 통해 MySQL에 구축 및 관리됩니다.

활용 API 필드: sggCd, umdNm, jibun, roadNm (주소 정보 활용하여 입지 데이터 매핑)

주차 환경: 세대당 주차 대수 = 총 주차대수 / 총 세대수를 계산하여 비교합니다. 이 데이터는 MySQL에 미리 구축된 데이터베이스에서 활용됩니다.

활용 API 필드: 없음

비교 규칙 및 문장 생성: 각 비교 항목에 대해 미리 정의된 규칙(예: "X% 이상 차이 나면 '큰 차이', Y% 이하면 '유사'")에 따라 비교 문장을 생성합니다.

예시 로직:

if (A.price_change_1yr > B.price_change_1yr) {
    report.push(`매물 A는 최근 1년간 ${A.price_change_1yr}% 상승하여 매물 B(${B.price_change_1yr}% 하락)보다 긍정적인 흐름을 보였습니다.`);
} else if (A.price_change_1yr < B.price_change_1yr) {
    report.push(`매물 B는 최근 1년간 ${B.price_change_1yr}% 상승하여 매물 A(${A.price_change_1yr}% 하락)보다 더 좋은 흐름을 보였습니다.`);
} else {
    report.push(`두 매물 모두 최근 1년간 가격 변동률이 유사합니다.`);
}

if (A.walk_to_station_min < B.walk_to_station_min) {
    report.push(`매물 A가 ${A.walk_to_station_min}분으로 매물 B(${B.walk_to_station_min}분)보다 역세권 접근성이 더 우수합니다.`);
}
// ... 기타 비교 항목 로직

비교 불가능한 경우 처리: 데이터 누락 또는 비교 대상이 너무 적은 경우 등 비교가 어려운 상황에서는 "비교에 필요한 데이터가 부족합니다." 또는 "선택된 매물 간의 유의미한 차이를 발견하기 어렵습니다." 등의 안내 메시지를 표시합니다.

리포트 표시: 생성된 텍스트 리포트와 함께, 주요 수치(가격 변동률, 평당 가격 등)는 표 또는 간단한 막대/원형 그래프로 시각화하여 제공합니다.

UI 요소 및 상호작용:

매물 리스트 테이블:

컬럼: 단지명, 면적, 주소, 최근 실거래가, 최근 전세가, 사용승인일, 세대수, '나만의 메모' (편집 가능).

'컬럼 추가' 버튼: 클릭 시 컬럼 이름 입력 팝업.

태그 입력 필드/선택 드롭다운: 각 매물 행에 태그 추가/선택 UI. (입력 가이드 텍스트 제공)

각 행 좌측에 체크박스 (비교 대상 선택용).

필터/정렬 컨트롤: 테이블 상단에 드롭다운, 슬라이더, 입력 필드 등.

'비교하기' 버튼: 2개 이상 선택 시 활성화. 클릭 시 비교 분석 리포트 팝업/모달.

하단 액션 버튼:

'시트 내보내기' 버튼: 현재 시트 데이터를 CSV 파일로 다운로드할 수 있는 기능을 제공합니다. (CSV/Excel 포맷 선택 옵션, 내보낼 컬럼 선택 옵션 고려)

'선택 매물 삭제' 버튼: 클릭/탭 시 선택된 매물 삭제 확인 팝업 후 삭제.

데이터 요구사항:

사용자 개인 시트 데이터 (MongoDB): 각 매물 정보 (단지명, 면적, 주소, 가격, 전세가, 준공연도, 세대수, 나만의 메모, 사용자 정의 컬럼, 태그).

비교 분석용 추가 데이터 (MySQL): 과거 실거래가 이력, 단지별 상세 입지 데이터(역과의 거리, 학군 정보), 주차 정보 등.

3.5. '개별 매물 상세 분석' 기능
목적: 사용자가 '나만의 시트'에 추가한 개별 매물에 대해 심층적인 정보를 확인하고, 시세 변동 추이를 시각적으로 파악할 수 있도록 합니다.

사용자 흐름:

'나만의 시트' 테이블에서 특정 매물 행을 클릭/탭합니다.

해당 매물의 상세 정보가 확장된 패널 또는 팝업 형태로 표시됩니다.

'핵심 요약' 텍스트를 확인합니다.

'상세 시세 변동 추이' 섹션에서 매매가, 전세가, 전세가율, 거래량의 월별/분기별 테이블 및 그래프를 확인합니다.

하단의 '중요 고지' 문구를 확인합니다.

상세 로직:

정보 조회: 선택된 매물의 고유 ID를 기반으로 백엔드 API를 호출하여 해당 매물의 모든 상세 정보와 과거 실거래가 이력을 조회합니다. (예: GET /api/properties/{propertyId}/detailed-analysis)

이때, 국토부 API의 LAWD_CD와 DEAL_YMD를 조합하여 특정 매물(단지 및 면적)의 과거 모든 실거래가 이력을 조회합니다. aptSeq (단지 일련번호)와 excluUseAr (전용면적)를 활용하여 해당 매물의 정확한 데이터를 필터링합니다. 국토부 API는 DEAL_YMD가 필수이므로, 특정 매물의 모든 과거 데이터를 조회하려면 월별로 반복 호출해야 합니다. 이 부분에 대한 성능 최적화를 위해 MySQL에 미리 집계된 시세 데이터를 저장(캐싱)하는 전략을 강력히 권장합니다.

핵심 요약: MySQL에 미리 구축된 데이터베이스에서 해당 매물의 특징을 기반으로 요약 텍스트를 조회하여 표시합니다.

상세 시세 변동 추이:

데이터 가공: 국토부 실거래가 이력 데이터를 월별/분기별로 집계하여 평균 매매가, 평균 전세가, 총 거래량 등을 계산합니다.

활용 API 필드: dealAmount, dealYear, dealMonth, dealDay, excluUseAr, aptSeq

전세가율 계산: 각 시점의 (평균 전세가 / 평균 매매가) * 100을 계산합니다.

테이블 표시: 계산된 데이터를 테이블 형태로 나열합니다.

그래프 시각화: JavaScript 기반 차트 라이브러리(예: Chart.js)를 사용하여 테이블 데이터를 기반으로 꺾은선 그래프(매매가, 전세가, 전세가율) 및 막대 그래프(거래량)를 생성하여 표시합니다. 웹에서는 인터랙티브(툴팁, 확대/축소)하게, 앱에서는 터치 제스처를 활용한 인터랙션을 제공합니다. 추가적으로 1년, 3년, 5년, 전체 등 기간 선택 옵션을 제공하여 사용자가 원하는 기간의 추이를 볼 수 있도록 합니다.

UI 요소 및 상호작용:

확장 패널/팝업:

'핵심 요약' 섹션: 텍스트 블록으로 요약 정보 표시.

'상세 시세 변동 추이' 섹션:

데이터 테이블: 기간, 매매가, 전세가, 전세가율, 거래량 컬럼.

꺾은선 그래프: 매매가, 전세가, 전세가율 추이.

막대 그래프: 거래량 추이.

'중요 고지' 텍스트: 명확하게 표시.

데이터 로딩/빈 상태: 데이터 로딩 중에는 로딩 스피너를 표시하고, 데이터가 부족할 경우 "시세 정보가 부족합니다." 메시지를 표시합니다.

닫기 버튼: 클릭/탭 시 패널/팝업 닫힘.

데이터 요구사항:

국토부 실거래가 API 응답 데이터: 특정 매물(단지 및 면적)의 과거 모든 실거래가 이력.

미리 구축된 데이터베이스 (MySQL): 매물별 핵심 요약 텍스트.

3.6. 관심 매물/단지 알림 설정
목적: 사용자가 직접 확인하지 않아도, 관심 있는 부동산 정보의 중요한 변화를 실시간으로 알림 받을 수 있도록 합니다.

사용자 흐름:

로그인 후 '알림 설정' 페이지로 이동합니다.

'가격 변동 알림', '신규 실거래가 알림', '맞춤 조건 매물 알림' 등의 옵션을 확인합니다.

각 알림 종류에 대해 활성화/비활성화를 토글하고, 필요한 경우 세부 조건(예: 가격 변동률 임계치, 알림 받을 지역/면적)을 설정합니다.

설정 저장 버튼을 클릭합니다.

설정된 조건에 부합하는 이벤트 발생 시, 웹/앱 푸시 알림을 수신합니다.

상세 로직:

알림 설정 저장:

클라이언트에서 사용자가 설정한 알림 종류, 조건, 알림 방식(웹 푸시, 앱 푸시 토큰 저장)을 백엔드로 전송하여 사용자 ID에 매핑하여 MongoDB에 저장합니다. (예: users 컬렉션 내 알림 설정 정보로 저장)

웹 푸시와 앱 푸시를 위한 푸시 토큰 관리 전략: 푸시 토큰은 기기별로 발급되며, 토큰 만료 시 자동 갱신 로직을 구현하고, 앱 삭제 또는 브라우저 푸시 거부 시 토큰을 삭제하는 로직을 포함합니다.

백엔드 알림 모니터링 및 발송:

주기적 데이터 업데이트: 백엔드 시스템은 국토부 부동산 실거래가 API를 주기적으로 호출하여 최신 데이터를 업데이트합니다. (예: 매일 새벽 2시로 설정합니다.)

활용 API: '아파트 매매 실거래가 상세 자료' API (getRTMSDataSvcAptTradeDev)를 활용하여 최신 거래 데이터를 지속적으로 모니터링.

변경 감지: 업데이트된 데이터와 기존 데이터(이전 스냅샷)를 비교하여 변경 사항을 감지합니다. 이 스냅샷 데이터는 MongoDB에 저장됩니다. 변경 감지를 위한 이전 스냅샷은 매일 생성하며, 3개월 보관 후 삭제하는 데이터 모델링을 적용합니다.

가격 변동 알림: 저장된 매물의 현재 실거래가와 이전 실거래가를 비교하여 설정된 임계치(예: 5%)를 초과하는 변동이 감지될 경우. (dealAmount 필드 활용)

신규 실거래가 알림: 관심 단지/면적에 새로운 계약일의 실거래가 데이터가 추가된 경우. (dealYear, dealMonth, dealDay 필드 활용)

맞춤 조건 매물 알림: 사용자가 설정한 필터 조건(예: 특정 지역, 특정 면적, 특정 가격 이하)에 새로 등록된 매물이 일치하는 경우. (LAWD_CD, excluUseAr, dealAmount 등 필드 활용)

알림 발송: 변경 사항이 감지되고 알림 조건이 충족되면, 해당 알림을 구독한 사용자에게 웹 푸시 또는 앱 푸시(Firebase Cloud Messaging)를 발송합니다. 알림 발송 시, 사용자가 설정한 알림 방식(웹 푸시만, 앱 푸시만, 둘 다)을 정확히 따르도록 하는 로직을 명세해야 합니다.

푸시 알림 페이로드 예시:

{
    "title": "가격 변동 알림: [단지명] [면적] 📈",
    "body": "최근 실거래가가 10.5억으로 5% 상승했습니다. (이전 10억)",
    "data": {
        "type": "price_change",
        "propertyId": "abc123def456"
    }
}

UI 요소 및 상호작용:

알림 설정 페이지:

각 알림 종류별 토글 스위치 (활성화/비활성화).

'가격 변동 알림' 설정: 변동률 임계치 입력 필드 (예: 5%, 10%).

'맞춤 조건 매물 알림' 설정: 지역, 면적, 가격대 등 필터 조건 설정 UI.

'알림 방식' 선택 (웹 푸시, 앱 푸시). 각 푸시 알림 수신 동의 여부 및 기기/브라우저 푸시 설정 안내를 명확히 제공합니다. 사용자가 푸시 알림을 받지 못할 경우, 앱 내에서 푸시 알림 설정 가이드 링크를 제공하여 문제 해결을 돕는 UX를 고려합니다.

'설정 저장' 버튼.

데이터 요구사항:

사용자 알림 설정 (MongoDB): 사용자별 알림 구독 정보 (알림 종류, 조건, 푸시 토큰).

매물 데이터 스냅샷 (MongoDB): 알림 변경 감지를 위해 각 매물의 이전 상태 데이터 (가격, 거래량 등)를 주기적으로 저장.