Naver 부동산 매물 정보 크롤링 기능 명세서
1. 문서 개요
본 기능 명세서는 "Naver 부동산 매물 정보 크롤링 기획서"를 기반으로, 프로젝트의 각 구성 요소가 수행해야 할 기능과 그 동작 방식을 상세히 정의합니다. 이는 개발 팀이 시스템을 구현하는 데 필요한 구체적인 지침을 제공합니다.

2. 시스템 아키텍처 (고수준)
크롤링 시스템은 크게 다음과 같은 모듈로 구성되며, 순차적으로 데이터를 수집하고 처리합니다.

+---------------------+     +---------------------+     +---------------------+
|                     |     |                     |     |                     |
|  스케줄러 (외부)    |---->|  메인 크롤러 제어   |---->|  API 요청 및 응답   |
| (Cron/Task Scheduler)|     |  (Request Handler)  |     |                     |
|                     |     |                     |     |                     |
+----------^----------+     +----------|----------+     +----------|----------+
           |                         |                         |
           |                         V                         V
           |                +---------------------+     +---------------------+
           |                |                     |     |                     |
           |                |  인증/헤더 관리     |     |  데이터 추출/파싱   |
           |                |  (Auth/Header Mgr)  |     |  (Data Extractor)   |
           |                |                     |     |                     |
           |                +----------|----------+     +----------|----------+
           |                         |                         |
           |                         V                         V
           |                +---------------------+     +---------------------+
           |                |                     |     |                     |
           +----------------|  데이터 저장        |<----|  페이지네이션 제어  |
                            |  (Storage Manager)  |     |  (Pagination Ctrl)  |
                            |                     |     |                     |
                            +---------------------+     +---------------------+

3. 기능 모듈별 상세 명세
3.1. 메인 크롤러 제어 모듈 (Orchestrator)
기능 ID: F-MAIN-001

기능명: 크롤링 프로세스 시작 및 종료 제어

설명: 외부 스케줄러에 의해 호출되어 전체 크롤링 프로세스를 시작하고, 모든 페이지의 데이터 수집 및 저장이 완료되면 프로세스를 종료합니다.

입력: 없음 (스케줄러에 의해 트리거)

출력: 없음 (내부적으로 데이터 저장 및 로깅 수행)

동작:

인증/헤더 관리 모듈을 호출하여 최신 인증 정보(토큰, 쿠키)를 확보합니다.

페이지네이션 제어 모듈을 호출하여 지정된 아파트 단지의 모든 매물 데이터를 순차적으로 수집하도록 지시합니다.

수집된 모든 데이터를 데이터 저장 모듈로 전달하여 CSV 파일로 저장하도록 지시합니다.

크롤링 과정에서 발생한 주요 이벤트 및 오류를 로깅 모듈을 통해 기록합니다.

3.2. API 요청 및 응답 모듈 (Request Handler)
기능 ID: F-REQ-001

기능명: Naver 부동산 API에 HTTP GET 요청 전송

설명: 지정된 URL과 파라미터, 헤더를 사용하여 Naver 부동산 API에 HTTP GET 요청을 보내고, 응답을 받습니다.

입력:

url (문자열): 요청할 API 엔드포인트 URL

params (딕셔너리): 쿼리 파라미터 (예: page, complexNo, realEstateType 등)

headers (딕셔너리): HTTP 요청 헤더 (User-Agent, Accept-Language, Referer, Authorization 등)

cookies (딕셔너리): HTTP 요청 쿠키

출력:

성공 시: API 응답 JSON 데이터 (딕셔너리 형태)

실패 시: None 또는 예외 발생 (내부적으로 로깅)

동작:

requests 라이브러리를 사용하여 HTTP GET 요청을 보냅니다.

요청 타임아웃을 설정합니다 (예: 10초).

HTTP 상태 코드(200 OK)를 확인하고, 오류 발생 시 F-ERR-001에 따라 처리합니다.

응답 내용을 JSON 형식으로 파싱하여 반환합니다.

3.3. 인증/헤더 관리 모듈 (Auth/Header Manager)
기능 ID: F-AUTH-001

기능명: 최신 인증 토큰 및 쿠키 확보

설명: Naver 부동산 API 요청에 필요한 Authorization 토큰과 Cookie 값을 관리하고 제공합니다.

입력: 없음

출력:

headers (딕셔너리): 최신 Authorization 토큰이 포함된 HTTP 헤더

cookies (딕셔너리): 최신 쿠키 값들이 포함된 HTTP 쿠키

동작:

초기 구현 시: 사전에 수집된 유효한 토큰과 쿠키 값을 하드코딩하거나 설정 파일에서 로드합니다.

향후 확장 시 (선택):

Selenium 등을 사용하여 Naver 부동산 로그인 페이지에 접속, 로그인 과정을 자동화하여 동적으로 토큰과 쿠키를 획득하는 로직을 구현합니다.

토큰의 유효 기간을 체크하고, 만료가 임박하거나 만료된 경우 자동 갱신을 시도합니다.

획득한 헤더와 쿠키를 반환합니다.

3.4. 데이터 추출/파싱 모듈 (Data Extractor)
기능 ID: F-EXT-001

기능명: JSON 응답에서 매물 정보 추출 및 정제

설명: API 요청 및 응답 모듈로부터 받은 JSON 응답에서 핵심 매물 정보 필드를 추출하고, 필요한 경우 데이터를 정제합니다.

입력: api_response_json (딕셔너리): Naver 부동산 API의 원본 JSON 응답

출력: articles_list (리스트): 각 딕셔너리가 하나의 매물 정보를 담고 있는 리스트

동작:

api_response_json 내의 articleList 키를 찾아 매물 리스트를 순회합니다.

각 매물(article) 딕셔너리에서 다음 필드를 추출합니다: articleNo, realEstateType, tradeType, price, areaString, floorInfo, buildingName, registDate, confirmDate, direction, articleFeatureDesc, agentName, telNo.

필드가 존재하지 않을 경우 None 또는 기본값으로 처리하여 오류를 방지합니다.

추출된 데이터를 새로운 딕셔너리 형태로 구성하여 리스트에 추가합니다.

완성된 매물 정보 리스트를 반환합니다.

3.5. 데이터 저장 모듈 (Storage Manager)
기능 ID: F-SAVE-001

기능명: 수집된 매물 정보를 CSV 파일로 저장

설명: 데이터 추출/파싱 모듈에서 전달받은 매물 정보 리스트를 CSV 파일 형태로 저장합니다.

입력:

articles_data (리스트): 저장할 매물 정보 딕셔너리 리스트

complex_no (정수): 아파트 단지 번호

출력: 없음 (CSV 파일 생성)

동작:

pandas 라이브러리를 사용하여 articles_data를 DataFrame으로 변환합니다.

현재 날짜와 시간을 포함하는 고유한 파일명을 생성합니다 (예: YYYYMMDD_HHMMSS_complex_27643_articles.csv).

DataFrame을 CSV 파일로 저장합니다. 이때, 한글 깨짐 방지를 위해 encoding='utf-8-sig'를 사용하고, 인덱스는 저장하지 않습니다 (index=False).

파일 저장 성공/실패 여부를 로깅 모듈을 통해 기록합니다.

3.6. 페이지네이션 제어 모듈 (Pagination Controller)
기능 ID: F-PAG-001

기능명: 모든 페이지의 매물 데이터 순차적 수집

설명: API 요청 및 응답 모듈을 사용하여 page 파라미터를 증가시키며 모든 매물 페이지를 순차적으로 크롤링합니다.

입력:

complex_no (정수): 크롤링할 아파트 단지 번호

initial_headers (딕셔너리): 초기 HTTP 헤더

initial_cookies (딕셔너리): 초기 HTTP 쿠키

출력: all_articles_data (리스트): 모든 페이지에서 수집된 매물 정보의 통합 리스트

동작:

현재 페이지 번호를 1로 초기화합니다.

무한 루프를 시작하여 페이지를 반복합니다.

API 요청 및 응답 모듈을 호출하여 현재 페이지의 데이터를 요청합니다.

응답이 없거나 articleList가 비어있으면 더 이상 매물이 없다고 판단하고 루프를 종료합니다.

데이터 추출/파싱 모듈을 호출하여 현재 페이지의 매물 데이터를 추출합니다.

추출된 데이터를 전체 매물 리스트에 추가합니다.

다음 페이지 번호로 증가시키고, 요청 간 지연을 위해 time.sleep()을 호출합니다 (예: 1~3초).

모든 페이지 수집이 완료되면 통합된 매물 리스트를 반환합니다.

3.7. 로깅 모듈 (Logging Module)
기능 ID: F-LOG-001

기능명: 시스템 운영 로그 기록

설명: 크롤링 프로세스의 시작/종료, 데이터 수집 현황, 오류 발생 등 주요 이벤트를 기록합니다.

입력:

level (문자열): 로그 레벨 (INFO, WARNING, ERROR)

message (문자열): 기록할 로그 메시지

출력: 없음 (로그 파일 또는 콘솔에 기록)

동작:

Python의 logging 모듈을 사용하여 로그를 설정합니다.

로그는 콘솔에 출력되고, 선택적으로 파일로 저장될 수 있습니다 (예: crawler_log_YYYYMMDD.log).

각 로그 메시지에는 타임스탬프, 로그 레벨, 메시지 내용이 포함됩니다.

3.8. 오류 처리 모듈 (Error Handling)
기능 ID: F-ERR-001

기능명: HTTP 요청 및 데이터 처리 오류 관리

설명: API 요청 및 응답 모듈 및 기타 데이터 처리 과정에서 발생할 수 있는 오류를 감지하고 처리합니다.

입력: 발생한 예외 객체 또는 오류 메시지

출력: 없음 (오류 로깅, 재시도 또는 프로세스 종료)

동작:

try-except 블록을 사용하여 requests.exceptions.RequestException, json.JSONDecodeError 등 예상되는 예외를 처리합니다.

오류 발생 시 로깅 모듈을 통해 오류 메시지와 스택 트레이스를 ERROR 레벨로 기록합니다.

재시도 로직: 네트워크 오류와 같이 일시적인 오류의 경우, 일정 횟수(예: 3회)까지 지연 후 재시도를 수행합니다.

지속적인 오류 발생 시, 해당 요청을 건너뛰거나 전체 크롤링 프로세스를 안전하게 종료합니다.

4. 비기능 요구사항 (Non-Functional Requirements)
성능:

API 요청 간 최소 1초 이상의 지연 시간을 두어 서버 부하를 줄입니다.

대량 데이터 처리 시 메모리 사용량을 최적화합니다.

보안:

인증 토큰 및 쿠키는 코드 내에 직접 노출되지 않도록 환경 변수 또는 설정 파일을 통해 관리합니다 (향후 확장 시).

유지보수성:

코드에 충분한 주석을 달고, 모듈별로 기능을 분리하여 가독성과 유지보수성을 높입니다.

API 변경에 유연하게 대응할 수 있도록 파싱 로직을 모듈화합니다.

배포:

Python 가상 환경을 사용하여 의존성 관리를 용이하게 합니다.

5. 의존성 (Dependencies)
Python 3.x

requests 라이브러리 (HTTP 요청)

pandas 라이브러리 (데이터프레임 처리 및 CSV 저장)

datetime 모듈 (파일명에 타임스탬프 추가)

logging 모듈 (로그 기록)

(선택적) selenium 및 웹 드라이버 (로그인 자동화 시)

6. 테스트 시나리오 (예시)
성공 케이스:

단일 페이지의 매물 정보가 성공적으로 수집되고 CSV 파일로 저장되는지 확인.

모든 페이지의 매물 정보가 누락 없이 수집되고 통합 CSV 파일로 저장되는지 확인.

생성된 CSV 파일의 데이터 필드와 형식이 올바른지 확인.

실패 케이스:

API 요청 실패(404, 500 등) 시 적절한 오류 로깅 및 재시도(또는 종료)가 이루어지는지 확인.

인증 토큰 만료 시 시스템이 어떻게 반응하는지 확인 (오류 로깅, 재시도 또는 재인증 시도).

네트워크 연결 끊김 시 오류 처리 및 로깅이 올바른지 확인.

비정상적인 JSON 응답(예: articleList 없음)에 대한 예외 처리가 작동하는지 확인.